---
description: Workflow rules for Cursor when working on 4lock-core: verification, build/run, testing. No Tauri/frontend; Makefile and Cargo are the main entry points.
alwaysApply: true
---

# Cursor Workflow Rules for 4lock-core

This is a **Linux-only Rust workspace** (blob, container, vapp_core). Build and run via **Cargo** on Linux or **Makefile + nerdctl** in a container. No Tauri, no frontend.

**CRITICAL**: Before starting any task, consult:
- `.cursor/docs/00-overview.md` and `.cursor/docs/01-crate-architecture.md`
- `.cursor/rules/05-architecture-usage.mdc` and `.cursor/rules/01-core-project.mdc`

---

## Task Lifecycle (When Running Builds or Tests)

1. **Verification** – Check environment (Rust, nerdctl if using make, Linux if running natively).
2. **Execution** – Run the task (`make`, `cargo build`, `cargo test`, etc.).
3. **Validation** – Confirm build/tests pass; state expected outcome.

No mandatory log-file creation or Tauri-specific cleanup; use standard Cargo/Makefile output.

---

## Build and Run (Source of Truth)

- **On Linux (native)**: `cargo build -p daemon`, `cargo build -p vapp_core --release --bin vapp-core-daemon`, `cargo test --workspace`.
- **Any host (container)**: `make` (default: build then run), `make build`, `make run`, `make build-dev && make run-dev`.
- **make run / make run-dev**: Container runs detached under name `4lock-core-run`; Makefile attaches with `nerdctl logs -f`. **Ctrl+C** in the terminal stops the container, removes it, and exits (trap + explicit `nerdctl stop`/`nerdctl rm`; nerdctl does not allow `-d` and `--rm` together).
- **Makefile**: See repo root `Makefile`; optional `.env` for `TARGET_ARCH`, `GH_OWNER`, `GH_TOKEN`. `TARGET_ARCH` auto-detected from host if unset.

Always run **from repo root**. Prefer showing exact commands.

---

## Testing

- After code changes: `cargo check -p <crate>` and `cargo test -p <crate>` for affected crates.
- Full workspace: `cargo test --workspace` when touching cross-crate behavior.
- Describe what to run and what success looks like; do not assume tests pass.

---

## Summary

- **Default run**: `make` → build then run (release image in container).
- **Fast iteration**: `make build-dev && make run-dev`.
- **No Tauri/frontend** – No pnpm, no log cleanup rules for a desktop app; keep workflow focused on Cargo and Makefile.
